#IfWinNotActive ahk_group IgnoredApps

    *escape::processKeyDown(layout["escape"])
    *escape up::processKeyUp(layout["escape"])
    
    *f1::processKeyDown(layout["F1"])
    *f1 up::processKeyUp(layout["F1"])
    
    *f2::processKeyDown(layout["F2"])
    *f2 up::processKeyUp(layout["F2"])
    
    *f3::processKeyDown(layout["F3"])
    *f3 up::processKeyUp(layout["F3"])
    
    *f4::processKeyDown(layout["F4"])
    *f4 up::processKeyUp(layout["F4"])
    
    *f5::processKeyDown(layout["F5"])
    *f5 up::processKeyUp(layout["F5"])
    
    *f6::toggleRealTimeDebug(showRealTimeDebugInfo)

    *f7::processKeyDown(layout["F7"])
    *f7 up::processKeyUp(layout["F7"])
    
    *f8::processKeyDown(layout["F8"])
    *f8 up::processKeyUp(layout["F8"])
    
    *f9::processKeyDown(layout["F9"])
    *f9 up::processKeyUp(layout["F9"])
    
    *f10::processKeyDown(layout["F10"])
    *f10 up::processKeyUp(layout["F10"])
    
    *f11::processKeyDown(layout["F11"])
    *f11 up::processKeyUp(layout["F11"])
    
    *f12::processKeyDown(layout["F12"])
    *f12 up::processKeyUp(layout["F12"])
    
    *home::processKeyDown(layout["home"])
    *home up::processKeyUp(layout["home"])
            
    *end::processKeyDown(layout["end"])
    *end up::processKeyUp(layout["end"])
        
    *insert::processKeyDown(layout["insert"])
    *insert up::processKeyUp(layout["insert"])
            
    *delete::processKeyDown(layout["delete"])
    *delete up::processKeyUp(layout["delete"])
        
    *sc029::processKeyDown(layout["``"])
    *sc029 up::processKeyUp(layout["``"])        
    
    *1::processKeyDown(layout[1])
    *1 up::processKeyUp(layout[1])
    
    *2::processKeyDown(layout[2])
    *2 up::processKeyUp(layout[2])
        
    *3::processKeyDown(layout[3])
    *3 up::processKeyUp(layout[3])
    
    *4::processKeyDown(layout[4])
    *4 up::processKeyUp(layout[4])
    
    *5::processKeyDown(layout[5])
    *5 up::processKeyUp(layout[5])
    
    *6::processKeyDown(layout[6])
    *6 up::processKeyUp(layout[6])
            
    *7::processKeyDown(layout[7])
    *7 up::processKeyUp(layout[7])
    
    *8::processKeyDown(layout[8])
    *8 up::processKeyUp(layout[8])
        
    *9::processKeyDown(layout[9])
    *9 up::processKeyUp(layout[9])
    
    *0::processKeyDown(layout[0])
    *0 up::processKeyUp(layout[0])
    
    *-::processKeyDown(layout["-"])
    *- up::processKeyUp(layout["-"])
    
    *=::processKeyDown(layout["="])
    *= up::processKeyUp(layout["="])
            
    *backspace::processKeyDown(layout["backspace"])
    *backspace up::processKeyUp(layout["backspace"])
        
    *tab::processKeyDown(layout["tab"])
    *tab up::processKeyUp(layout["tab"])
    
    *q::processKeyDown(layout["q"])
    *q up::processKeyUp(layout["q"])
    
    *w::processKeyDown(layout["w"])
    *w up::processKeyUp(layout["w"])
    
    *e::processKeyDown(layout["e"])
    *e up::processKeyUp(layout["e"])
    
    *r::processKeyDown(layout["r"])
    *r up::processKeyUp(layout["r"])
    
    *t::processKeyDown(layout["t"])
    *t up::processKeyUp(layout["t"])
    
    *y::processKeyDown(layout["y"])
    *y up::processKeyUp(layout["y"])
    
    *u::processKeyDown(layout["u"])
    *u up::processKeyUp(layout["u"])
    
    *i::processKeyDown(layout["i"])
    *i up::processKeyUp(layout["i"])
    
    *o::processKeyDown(layout["o"])
    *o up::processKeyUp(layout["o"])
    
    *p::processKeyDown(layout["p"])
    *p up::processKeyUp(layout["p"])
    
    *[::processKeyDown(layout["["])
    *[ up::processKeyUp(layout["["])
    
    *]::processKeyDown(layout["]"])
    *] up::processKeyUp(layout["]"])
    
    *\::processKeyDown(layout["\"])
    *\ up::processKeyUp(layout["\"])
            
    *capslock::processKeyDown(layout["capslock"])
    *capslock up::processKeyUp(layout["capslock"])
    
    *a::processKeyDown(layout["a"])
    *a up::processKeyUp(layout["a"])
    
    *s::processKeyDown(layout["s"])
    *s up::processKeyUp(layout["s"])
    
    *d::processKeyDown(layout["d"])
    *d up::processKeyUp(layout["d"])
    
    *f::processKeyDown(layout["f"])
    *f up::processKeyUp(layout["f"])
    
    *g::processKeyDown(layout["g"])
    *g up::processKeyUp(layout["g"])
    
    *h::processKeyDown(layout["h"])
    *h up::processKeyUp(layout["h"])
    
    *j::processKeyDown(layout["j"])
    *j up::processKeyUp(layout["j"])
    
    *k::processKeyDown(layout["k"])
    *k up::processKeyUp(layout["k"])
    
    *l::processKeyDown(layout["l"])
    *l up::processKeyUp(layout["l"])
    
    *`;::processKeyDown(layout[";"])
    *`; up::processKeyUp(layout[";"])
    
    *'::processKeyDown(layout["'"])
    *' up::processKeyUp(layout["'"])
        
    *enter::processKeyDown(layout["enter"])
    *enter up::processKeyUp(layout["enter"])
            
    *z::processKeyDown(layout["z"])
    *z up::processKeyUp(layout["z"])
    
    *x::processKeyDown(layout["x"])
    *x up::processKeyUp(layout["x"])
    
    *c::processKeyDown(layout["c"])
    *c up::processKeyUp(layout["c"])
    
    *v::processKeyDown(layout["v"])
    *v up::processKeyUp(layout["v"])
    
    *b::processKeyDown(layout["b"])
    *b up::processKeyUp(layout["b"])
    
    *n::processKeyDown(layout["n"])
    *n up::processKeyUp(layout["n"])
    
    *m::processKeyDown(layout["m"])
    *m up::processKeyUp(layout["m"])
    
    *sc033::processKeyDown(layout[","])
    *sc033 up::processKeyUp(layout[","])
    
    *sc034::processKeyDown(layout["."])
    *sc034 up::processKeyUp(layout["."])
    
    *sc035::processKeyDown(layout["/"])
    *sc035 up::processKeyUp(layout["/"])
    
    *space::processKeyDown(layout["space"])
    *space up::processKeyUp(layout["space"])
    
    *left::processKeyDown(layout["left"])
    *left up::processKeyUp(layout["left"])
    
    *down::processKeyDown(layout["down"])
    *down up::processKeyUp(layout["down"])
    
    *right::processKeyDown(layout["right"])
    *right up::processKeyUp(layout["right"])
    
    *up::processKeyDown(layout["up"])
    *up up::processKeyUp(layout["up"])
    
    *pgdn::processKeyDown(layout["pgdn"])
    *pgdn up::processKeyUp(layout["pgdn"])
    
    *pgup::processKeyDown(layout["pgup"])
    *pgup up::processKeyUp(layout["pgup"])
    
    *appskey::processKeyDown(layout["appskey"])
    *appskey up::processKeyUp(layout["appskey"])
    
    *printscreen::
        showtooltip("Exit")
        exitApp
    return
    *printscreen up::processKeyUp(layout["printscreen"])
    
    *lctrl::processModifierWhenKeyPhysicalDown("lctrl")
    *lctrl up::processModifierWhenKeyPhysicalUp("lctrl")
    
    *rctrl::processModifierWhenKeyPhysicalDown("rctrl")
    *rctrl up::processModifierWhenKeyPhysicalUp("rctrl")
    
    *lalt::processModifierWhenKeyPhysicalDown("lalt")
    *lalt up::processModifierWhenKeyPhysicalUp("lalt")
    
    *ralt::processModifierWhenKeyPhysicalDown("ralt")
    *ralt up::processModifierWhenKeyPhysicalUp("ralt")
    
    *lshift::processModifierWhenKeyPhysicalDown("lshift")
    *lshift up::processModifierWhenKeyPhysicalUp("lshift")
    
    *rshift::processModifierWhenKeyPhysicalDown("rshift")
    *rshift up::processModifierWhenKeyPhysicalUp("rshift")

    *pause::processKeyDown(layout["pause"])
    *pause up::processKeyUp(layout["pause"])

    *MButton::processKeyDown(layout["MButton"])
    *MButton up::processKeyUp(layout["MButton"])

    *XButton1::processKeyDown(layout["XButton1"])
    *XButton1 up::processKeyUp(layout["XButton1"])

    *XButton2::processKeyDown(layout["XButton2"])
    *XButton2 up::processKeyUp(layout["XButton2"])

#IfWinNotActive

processModifierWhenKeyPhysicalDown(key)
{
    if (GetKeyState(key, "P"))
    {
        processKeyDown(layout[key])
    }
}

; avoids strange ahk bug where modifier key lift is not received
processModifierWhenKeyPhysicalUp(key)
{           
    modifier := SubStr(key, 2)
    remappedWithKey := layout[key]
    if (GetKeyState(modifier) || GetKeyState(remappedWithKey) || isModifierKey(remappedWithKey))
    {
        processKeyUp(remappedWithKey)
    }
    else
    {
        removeFromActivePressedKeys(remappedWithKey)
        lastKeyProcessedAsAlternative := ""
    }
}
